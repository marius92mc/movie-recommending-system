<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>movie-recommending-system by marius92mc</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">movie-recommending-system</h1>
      <h2 class="project-tagline">Movie Recommending System built on Spark, using Flask and ReactJS</h2>
      <a href="https://github.com/marius92mc/movie-recommending-system" class="btn">View on GitHub</a>
      <a href="https://github.com/marius92mc/movie-recommending-system/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/marius92mc/movie-recommending-system/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="movie-recommending-system-using-spark" class="anchor" href="#movie-recommending-system-using-spark" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Movie Recommending System using Spark</h1>

<p>A web platform for recommending movies to users that 
log in with their Facebook account. They rate movies and receive recommendations based 
on their activity. They also receive a predicted rating for particular movies. </p>

<p>Technologies used: </p>

<ul>
<li>Apache Spark</li>
<li>Flask - Python based web framework </li>
<li>PostgreSQL</li>
<li>React</li>
<li>jQuery, Ajax</li>
<li>Bootstrap</li>
</ul>

<h2>
<a id="requirements-and-installation" class="anchor" href="#requirements-and-installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requirements and installation</h2>

<p>It is highly recommended to use <a href="http://docs.python-guide.org/en/latest/dev/virtualenvs/">virtualenv</a>. </p>

<p>Please see requirements.txt.
To install these packages, use the following command in a <a href="http://docs.python-guide.org/en/latest/dev/virtualenvs/"> virtualenv</a>.</p>

<pre><code>$ pip install -r requirements.txt
</code></pre>

<p>Download Spark v1.6.1 from <a href="http://spark.apache.org/downloads.html"> here</a>.</p>

<pre><code>$ tar -xf &lt;name_of_spark_archive&gt;.tar
</code></pre>

<p>Follow instructions from spark-1.6.1/README.md to build and install.</p>

<p>Environment variables in your ~/.bash_profile for OS X or ~/.bashrc for Linux.</p>

<pre><code>export SPARK_HOME=~/path/to/spark-1.6.1
export PYTHONPATH=$SPARK_HOME/python/:$PYTHONPATH
export PYTHONPATH=$SPARK_HOME/python:$SPARK_HOME/pyhon/lib/py4j-0.9-src.zip:$PYTHONPATH
</code></pre>

<p>Verify it was successfully installed by running </p>

<pre><code>$ ./bin/pyspark
</code></pre>

<p>from spark-1.6.1/</p>

<p>Copy <i>spark-env.sh</i>, <i>spark-defaults.conf</i> and <i>slaves</i> files 
from <i>spark_utils/</i> to <i>path/to/spark/conf/</i>. </p>

<ul>
<li>
<i>spark-env.sh</i> 

<ul>
<li>settings regarding the master node, like number of workers if manages, etc.
 Note: Edit the SCALA_HOME, SPARK_WORKER_DIR environment variables 
 to your local needs. </li>
</ul>
</li>
<li>
<i>spark-defaults.conf</i> 

<ul>
<li>settings regarding the workers. 
  Any values specified as flags or in the properties file will be 
  passed on to the  application and merged with those specified 
  through SparkConf invocation in the code. 
  Properties set directly on the SparkConf creation, in code, take highest precedence, 
  then flags passed to spark-submit or spark-shell, 
  then options in the spark-defaults.conf file.</li>
</ul>
</li>
<li>
<i>slaves</i> 

<ul>
<li>addresses of the workers.</li>
</ul>
</li>
</ul>

<p>For database we use PostgreSQL. 
Download and install it from <a href="http://www.postgresql.org/download/">here</a>.</p>

<p>Add the following to ~/.bash_profile </p>

<pre><code>export PATH=$PATH:/Applications/Postgres.app/Contents/Versions/latest/bin 
</code></pre>

<p>to ~/.bash_profile. </p>

<pre><code>$ which psql
</code></pre>

<p>should output like this</p>

<pre><code>/Applications/Postgres.app/Contents/Versions/latest/bin/psql
</code></pre>

<p>Create a PostgreSQL database</p>

<pre><code>$ createdb rs
</code></pre>

<p>To see the created database, got to Terminal and type 
"psql", then in the <i>postgres</i> console type "\l", 
which will list all the databases available, 
"\connect rs;" to connect to the newly created rs database created above, 
and "\d" will show the available tables from the connected database.</p>

<p>Note: When droping table from psql console, also drop the sequence mentioned in 
the models, otherwise the autoincrementing id will not be reseted, as it should be. </p>

<pre><code>DROP TABLE "Users"; DROP SEQUENCE seq_user_id; 
DROP TABLE "Movies"; DROP SEQUENCE seq_movie_id;
</code></pre>

<p>Install npm packages needed for React</p>

<pre><code>$ npm install
</code></pre>

<p>Any changes on the React components from app/templates/client/components/ or 
app/templates/client/index.js file should be followed by the <i>build</i> command.</p>

<p>Build bundle.js from all the npm packages, scripts with behavior defined in package.json,  </p>

<pre><code>$ npm run-script build
</code></pre>

<p>or to build bundle.js and run the webpack server </p>

<pre><code>$ npm run-script run 
</code></pre>

<p>To download the <b>dataset</b> that will be used, run the following script</p>

<pre><code>$ python download_dataset.py
</code></pre>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<ul>
<li>[ ] Write <b>full</b> instructions and an example. </li>
</ul>

<p>Activate the created virtualenv directory.</p>

<pre><code>source name_of_virtualenv_directory/bin/activate
</code></pre>

<h3>
<a id="1-starting-the-spark-master-and-workers" class="anchor" href="#1-starting-the-spark-master-and-workers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. Starting the Spark Master and Workers.</h3>

<p>From path/to/spark type</p>

<pre><code>$ sbin/start-master.sh
$ sbin/start-slaves.sh
</code></pre>

<p>or </p>

<pre><code>$ sbin/start-all.sh
</code></pre>

<p>Similar, to stop the Master and Workers. </p>

<pre><code>$ sbin/stop-master.sh
$ sbin/stop-slaves.sh
</code></pre>

<p>or </p>

<pre><code>$ sbin/stop-all.sh
</code></pre>

<p>See Spark stats via UI at</p>

<p><a href="http://localhost:8080">http://localhost:8080</a> </p>

<p><a href="http://localhost:4040">http://localhost:4040</a></p>

<h3>
<a id="2-sending-the-python-sources-to-spark-and-run-them" class="anchor" href="#2-sending-the-python-sources-to-spark-and-run-them" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. Sending the Python sources to Spark and run them</h3>

<p>Run from project directory, the following</p>

<pre><code>$ sh path/to/spark/bin/spark-submit \
           --master spark://&lt;server_name/server_ip&gt;:7077 \
           --num-executors 2 \
           --total-executor-cores 2 \
           --executor-memory 2g \
           server.py [options] &gt; stdout 2&gt; stderr
</code></pre>

<p>where server_name is yosemite/ubuntu/localhost if it's running locally. </p>

<p>Options, all <b>optional</b>, include:</p>

<pre><code>--dataset &lt;name&gt;
  Specify a dataset, e.g. "ml-latest" or "ml-latest-small". 
  If omitted, defaults to "ml-latest".
</code></pre>

<p>Logs can be seen in the above provided files.</p>

<pre><code>$ tail -f stdout
$ tail -f stderr
</code></pre>

<p>By default, as it is mentioned in <i>server.py</i>, CherryPy will use 
port 5434. 
Change it from the same file if it is busy.</p>

<h3>
<a id="3-operations-on-the-constructed-model" class="anchor" href="#3-operations-on-the-constructed-model" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. <b>Operations on the constructed model</b>
</h3>

<p>Go to <a href="http://0.0.0.0:5434/">http://0.0.0.0:5434/</a> and have <b>fun</b>. <g-emoji alias="fireworks" fallback-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f386.png">ðŸŽ†</g-emoji></p>

<p>Or interact with the constructed ML model via terminal with the following commands.</p>

<ul>
<li>
<b>POSTing new ratings</b> to the model</li>
</ul>

<pre><code>$ curl --data-binary @user_ratings/user_ratings.file http://0.0.0.0:5434/&lt;user_id&gt;/ratings
</code></pre>

<p>where user_id is 0 by default representing a total new user, 
outside from those mentioned in the dataset.</p>

<p><b>Description</b>: POSTs user_id's ratings from <i>user_ratings.file</i>, where 
every line has movie_id,rating. <br>
Will start some computations and end up with an output representing 
the ratings that has been submitted as a list of lists. <br>
In the server output window you will see the actual Spark computation 
output together with CherryPy's output messages about HTTP requests.</p>

<p>Output represents ratings as - (user_id, movie_id, rating)
rating awarded by the user from user_ratings.file.</p>

<ul>
<li><b>GETing best recommendations</b></li>
</ul>

<pre><code>$ curl http://0.0.0.0:5434/&lt;user_id&gt;/ratings/top/&lt;num_movies&gt;
</code></pre>

<p>or in browser </p>

<p><a href="http://0.0.0.0:5434/user_id/ratings/top/num_movies">http://0.0.0.0:5434/user_id/ratings/top/num_movies</a></p>

<p>Example</p>

<pre><code>$ curl http://0.0.0.0:5434/0/ratings/top/10
$ curl http://0.0.0.0:5434/3/ratings/top/10
</code></pre>

<p><a href="http://0.0.0.0:5434/0/ratings/top/10">http://0.0.0.0:5434/0/ratings/top/10</a></p>

<p><b>Description</b>: Will present the best num_movies recommendations for user with user_id.</p>

<ul>
<li><b>GETing individual ratings</b></li>
</ul>

<pre><code>$ curl http://0.0.0.0:5434/&lt;user_id&gt;/ratings/&lt;movie_id&gt;
</code></pre>

<p>or in browser</p>

<p><a href="http://0.0.0.0:5434/user_id/ratings/movie_id">http://0.0.0.0:5434/user_id/ratings/movie_id</a></p>

<p>Example</p>

<pre><code>curl http://0.0.0.0:5434/0/ratings/500
curl http://0.0.0.0:5434/3/ratings/500
</code></pre>

<p><a href="http://0.0.0.0:5434/0/ratings/500">http://0.0.0.0:5434/0/ratings/500</a></p>

<p><a href="http://0.0.0.0:5434/1/ratings/500">http://0.0.0.0:5434/1/ratings/500</a></p>

<p><b>Description</b>: Will get the predicted movie rating, from the model, of 
user_id for movie_id. </p>

<h2>
<a id="tests" class="anchor" href="#tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tests</h2>

<p>TODO</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>TODO</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/marius92mc/movie-recommending-system">movie-recommending-system</a> is maintained by <a href="https://github.com/marius92mc">marius92mc</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
